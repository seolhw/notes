### 一、查询预约单时对姓名证件号手机号爱康卡号进行验证

~~~javascript
 async queryList () {
      await this.$nextTick()
      let fieldList = []//需要验证的表单字段名，和验证失败的提示信息集合
      const { cardNumber, telephone, idNumber, examuser } = this.formInline
      examuser && fieldList.push({ name: 'examuser', msg: '客户姓名' })
      idNumber && fieldList.push({ name: 'idNumber', msg: '证件号码' })
      telephone && fieldList.push({ name: 'telephone', msg: '手机号' })
      cardNumber && fieldList.push({ name: 'cardNumber', msg: '爱康卡号' })
      let errList = await new Promise((resolve, reject) => {
        let i = 0
        let errList = []//验证失败之后的错误信息的集合
        this.$refs.formInline.validateField(fieldList.map(e => e.name), err => {
          if (err) {
            errList.push(fieldList[i].msg)
          }
          ++i >= fieldList.length && resolve(errList)//拿到返回内容
        })
      })
      if (!errList.length) {
        //全部验证成功之后的逻辑
      } else {
        //验证失败的逻辑
        this.$message({
          message: `${errList.toString()}验证失败`,
          type: 'error'
        })
      }
    }
~~~

思路：（1）先声明一个fieldList数组，里面是需要验证的表单字段的props名，和验证失败需要提示的信息内容；（2）声明一个promise对象，等待表单的每个字段验证完成之后，返回错误信息的数组(errList);（3）判断数组（errList）的长度，如果是0则代表所有字段都验证成功。

### 二、用户已经选择套餐之后，不可以更改基础信息的性别

~~~javascript
<el-form-item label="性别"
               prop="sex">
   <el-tooltip :content="`您已选择${genderList[genderInfo.gender]}性                          套餐`" 
                placement="top" 
                :disabled="!genderInfo.status">
      <el-select v-model="formInline.sex" 
                 no-match-text 
                 :disabled="genderInfo.status">
              <el-option label="男"
                         :value="1">
              </el-option>
              <el-option label="女"
                          :value="0">
               </el-option>
        </el-select>
    </el-tooltip>
</el-form-item>

data(){
    return {
        genderList: ['女', '男'],
    }
}
computed:{
    genderInfo () {
      let info = this.$store.getters.GetComboSelectListInfo
      console.log('选择的套餐', info)
      if (!info) return { status: false } // 没有选择套餐，可以选择性别
      // 以下是选择了套餐之后的逻辑
      let gender = info.sex
      if (gender !== 1 && gender !== 0) { // 全部，可以选择性别
        return { status: false }
      } else { // 男或者女不可以选择性别
        return { status: true, gender }
      }
    },
}
~~~

思路：获取套餐的性别，如果是全部则可以选择自己选择性别，如果是男性套餐或者女性套餐，则不可以再选择性别。

### 三、加项包的必选包必加选项默认添加至加项列表

~~~javascript
const selectComboAddItemList = list.filter(e => {
    return e.pselectType === 1 && e.selectType === 1
})//筛选出必选包必加选项
const comboAddItemList = []
let addItemList = state.addItemList.map(e => {
     return e.code
})//加项列表的code集合
selectComboAddItemList.forEach(e => {
  //加项列表里没有的话，添加至comboAddItemList
  !addItemList.includes(e.code) && comboAddItemList.push(e)
 })
//拼接完成后，组合成新的加项列表
 state.addItemList = state.addItemList.concat(comboAddItemList)
~~~

### 四、格式化时间

~~~javascript
/**
 * 时间格式化:2020-04-28 10:19:18
 * @param {*} time 时间戳
 * @param {*} cFormat y-m-d h:i:s a
 */
export function parseTime (time, cFormat) {
  if (arguments.length === 0) {
    return null
  }
  const format = cFormat || 'y-m-d h:i:s'
  let date
  if (typeof time === 'object') {
    date = time
  } else {
    if (('' + time).length === 10) time = parseInt(time) * 1000
    date = new Date(time)
  }
  const formatObj = {
    y: date.getFullYear(),
    m: date.getMonth() + 1,
    d: date.getDate(),
    h: date.getHours(),
    i: date.getMinutes(),
    s: date.getSeconds(),
    a: date.getDay()
  }
  return format.replace(/(y|m|d|h|i|s|a)/g, (result, key) => {
    let value = formatObj[key]
    if (key === 'a') { return ['日', '一', '二', '三', '四', '五', '六'][value] }
    if (result.length > 0 && value < 10) {
      value = '0' + value
    }
    return value || 0
  })
}
~~~

### 五、四舍五入保留两位小数

~~~javascript
export const discountFilter = price => {
  if (typeof price !== 'number') {
    console.error('你必须传一个number类型')
    return
  }
  let p = Math.round(price * 100) //四舍五入取整
  let r = p / 100
  if (p % 100) {
    console.log(p)
    !(p % 10) && (r = r.toString() + '0')
  } else {
    r = r.toString() + '.00'
  }
  return r
}
~~~

### 六、格式化金钱

~~~javascript
/**
 * 数字变为三位逗号分割(10,123,234)
 * @param {*} num 需要分割的数字
 */
export function numToFormat (num) {
  num = typeof num !== 'undefined' ? num + '' : ''
  let reg = /(?!^)(?=(\d{3})+$)/g
  return num.replace(reg, ',')
}
~~~

### 七、验证身份证是否合法

~~~javascript
export function IdentityCodeValid (code) {
  var city = { 11: '北京', 12: '天津', 13: '河北', 14: '山西', 15: '内蒙古', 21: '辽宁', 22: '吉林', 23: '黑龙江 ', 31: '上海', 32: '江苏', 33: '浙江', 34: '安徽', 35: '福建', 36: '江西', 37: '山东', 41: '河南', 42: '湖北 ', 43: '湖南', 44: '广东', 45: '广西', 46: '海南', 50: '重庆', 51: '四川', 52: '贵州', 53: '云南', 54: '西藏 ', 61: '陕西', 62: '甘肃', 63: '青海', 64: '宁夏', 65: '新疆', 71: '台湾', 81: '香港', 82: '澳门', 91: '国外 ' }
  // var tip = ''
  var pass = true
  if (!code || !/^[1-9][0-9]{5}(19[0-9]{2}|200[0-9]|2010)(0[1-9]|1[0-2])(0[1-9]|[12][0-9]|3[01])[0-9]{3}[0-9xX]$/i.test(code)) {
    // tip = '身份证号格式错误'
    pass = false
  } else if (!city[code.substr(0, 2)]) {
    // tip = '地址编码错误'
    pass = false
  } else {
    // 18位身份证需要验证最后一位校验位
    if (code.length === 18) {
      code = code.split('')
      code[17] = code[17].toUpperCase()
      // ∑(ai×Wi)(mod 11)
      // 加权因子
      var factor = [7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2]
      // 校验位
      var parity = [1, 0, 'X', 9, 8, 7, 6, 5, 4, 3, 2]
      var sum = 0
      var ai = 0
      var wi = 0
      for (var i = 0; i < 17; i++) {
        ai = code[i]
        wi = factor[i]
        sum += ai * wi
      }
      // var last = parity[sum % 11]
      if (parity[sum % 11] !== code[17]) {
        // tip = '校验位错误'
        pass = false
      }
    }
  }
  return pass
}
~~~

### 八、根据年龄计算生日

~~~javascript
export const jsGetAge = (strBirthday = '') => {
  // 增加对空的判断，避免报错
  if (typeof strBirthday !== 'string') return ''
  var returnAge
  var strBirthdayArr = strBirthday.split('-')
  var birthYear = strBirthdayArr[0]
  var birthMonth = strBirthdayArr[1]
  var birthDay = strBirthdayArr[2]
  let d = new Date()
  var nowYear = d.getFullYear()
  var nowMonth = d.getMonth() + 1
  var nowDay = d.getDate()
  if (Number(nowYear) === Number(birthYear)) {
    returnAge = 0
  } else {
    var ageDiff = nowYear - birthYear
    if (ageDiff > 0) {
      if (nowMonth === birthMonth) {
        var dayDiff = nowDay - birthDay
        if (dayDiff < 0) {
          returnAge = ageDiff - 1
        } else {
          returnAge = ageDiff
        }
      } else {
        var monthDiff = nowMonth - birthMonth
        if (monthDiff < 0) {
          returnAge = ageDiff - 1
        } else {
          returnAge = ageDiff
        }
      }
    } else {
      returnAge = -1
    }
  }
  return returnAge
}
~~~

# 九、双击获取当前内容并复制

~~~javascript

const oInput = document.createElement('input')// 创建input元素
oInput.value = row[property]// 设置input框的值
document.body.appendChild(oInput) //添加元素
oInput.select() // 选择对象
document.execCommand('Copy') // 复制
oInput.className = 'oInput'// 添加calss名
oInput.style.display = 'none'// 隐藏
~~~





