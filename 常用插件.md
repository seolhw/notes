## vue-cropper:剪裁图片

## blueimp-md5：加密

## crypto-js：aes解密

## html2canvas:JavaScript HTML渲染器

## SortableJS: JavaScript 拖拽库

## matomo数据（流量）统计

安装：npm i html2canvas

引入：

~~~javascript
<script src="node_modules/html2canvas/dist/html2canvas.min.js"></script>
~~~

~~~javascript
import html2canvas from 'html2canvas'
~~~

使用：

~~~javascript
<body>
  <script src="node_modules/html2canvas/dist/html2canvas.min.js"></script>
  <script src="./index.js"></script>
  <span onclick="htmc()">点击</span>
</body>
~~~

~~~javascript
function htmc(){
  html2canvas(document.body).then(function(canvas) {
    document.body.appendChild(canvas)
  })
}
~~~

## jspdf:生成pdf文档

 jsPDF 是一个基于 HTML5 的客户端解决方案,用于生成各种用途的 PDF 文档。 

安装：npm install jspdf

引入：

~~~javascript
<script src="node_modules/jspdf/dist/jspdf.min.js"></script>
~~~

~~~j
import JsPDF from 'jspdf'
~~~

使用

~~~javascript
var doc = new jsPDF()
doc.text('Hello world!', 10, 10)
doc.save('a4.pdf')//pdf文件名
~~~

### 场景1：将页面指定内容导出为pdf

html2canvas+jspdf

~~~javascript
<body>
  <script src="node_modules/html2canvas/dist/html2canvas.min.js"></script>
  <script src="node_modules/jspdf/dist/jspdf.min.js"></script>
  <script src="./index.js"></script>
  <div class="right-aside"> //导出pdf的内容
    <p>happyDay and happyEnding</p>
  </div>
  <span onclick="htmc()">导出pdf</span>
</body>
~~~

~~~javascript
function htmc() {
  var target = document.getElementsByClassName("right-aside")[0];
  target.style.background = "#FFFFFF";
  html2canvas(target).then((canvas=>{
    var contentWidth = canvas.width;
    var contentHeight = canvas.height;

    //一页pdf显示html页面生成的canvas高度;
    var pageHeight = contentWidth / 592.28 * 841.89;
    //未生成pdf的html页面高度
    var leftHeight = contentHeight;
    //页面偏移
    var position = 0;
    //a4纸的尺寸[595.28,841.89]，html页面生成的canvas在pdf中图片的宽高
    var imgWidth = 595.28;
    var imgHeight = 592.28/contentWidth * contentHeight;

    var pageData = canvas.toDataURL('image/jpeg', 1.0);

    var pdf = new jsPDF('', 'pt', 'a4');

    //有两个高度需要区分，一个是html页面的实际高度，和生成pdf的页面高度(841.89)
    //当内容未超过pdf一页显示的范围，无需分页
    if (leftHeight < pageHeight) {
    pdf.addImage(pageData, 'JPEG', 0, 0, imgWidth, imgHeight );
    } else {
        while(leftHeight > 0) {
            pdf.addImage(pageData, 'JPEG', 0, position, imgWidth, imgHeight)
            leftHeight -= pageHeight;
            position -= 841.89;
            //避免添加空白页
            if(leftHeight > 0) {
              pdf.addPage();
            }
        }
    }
    pdf.save("导出.pdf");
  }))
}
~~~

## SortableJS : JavaScript 拖拽库

安装：npm install sortablejs

import Sortable from sortablejs

cdn引入：

```javascript
<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
<script src="https://cdn.bootcss.com/Sortable/1.10.1/Sortable.js"></script>
```

详见：http://www.sortablejs.com/index.html

```javascript
this.$nextTick(() => {
   const el = document.querySelectorAll('.el-table__body-wrapper > table > tbody')[0]
   //拖拽的元素
      this.sortable = Sortable.create(el, {
        animation: 250,
        ghostClass: 'sortable-ghost', // for the drop placeholder,拖拽底层阴影的class
        dragClass: 'sortable-drag',//拖拽上层的class
        chosenClass: 'sortable-chosen',//阴影和上层都有
        forceFallback: true, // 拖拽时通过鼠标中间的滚轮，控制滚动条的滑动
        fallbackClass: 'sortable-fallback',//forceFallback设置为true时，拖放过程中鼠标附着单元的样式,拖拽的上层item
        setData: function (dataTransfer) {
          dataTransfer.setData('Text', '') // 火狐浏览器bug
        },
        onEnd: evt => {
          const targetRow = this.list.splice(evt.oldIndex, 1)[0]
          this.list.splice(evt.newIndex, 0, targetRow)
          // 如果拖拽则选中拖拽
          this.$refs.singleTable.setCurrentRow(this.list[evt.newIndex])
          this.$emit('changeRoderNum', evt.newIndex + 1)
        }
      })
})
```

## matomo数据（访问流量）统计

官网：https://matomo.org/

首先在main.js找那个引入vue-matomo

```javascript
import VueMatomo from 'vue-matomo'

Vue.use(VueMatomo, {
  host: 'http://matomo.na.xyz', // 这里配置你自己的piwik服务器地址和网站ID
  siteId: 3,//siteId值
  // 根据router自动注册
  router: router,
  // // 是否需要在发送追踪信息之前请求许可
  // // 默认false
  requireConsent: false,
  enableLinkTracking: true,
  // // 是否追踪初始页面
  // // 默认true
  trackInitialView: false,
  // // 最终的追踪js文件名
  // // 默认 'piwik'
  trackerFileName: 'matomo',
  debug: false
});

例：（判定条件）
if (globals.host.indexOf('uat') !== -1) {
  Vue.use(VueMatomo, {
    host: globals.statsCodeUrl.staUrl, // 这里是匹配到的地址
    siteId: globals.statsCodeUrl.staId, // 这里是匹配到的siteId值
    // 根据router自动注册
    router: router,
    // 是否需要在发送追踪信息之前请求许可, 默认false
    requireConsent: false,
    enableLinkTracking: true,
    // 是否追踪初始页面,默认true
    trackInitialView: false,
    // 最终的追踪js文件名,默认 'piwik'
    trackerFileName: 'matomo',
    debug: false
  })
}
```

router/index.js中（跟踪路由）

```javascript
router.beforeEach((to, from, next) => {
  // 线上环境不加 matomo 统计
  if (globals.host.indexOf('uat') !== -1) {
    let loginInfo = JSON.parse(window.localStorage.getItem('loginInfo'))
    window._paq.push(['setCustomUrl', `${window.location.protocol}//${window.location.host + to.path}`])
    if (loginInfo) {
      let userId = `userId=${loginInfo.id}；userName=${loginInfo.loginName}`
      window._paq.push(['setUserId', String(userId)])
    }
  }
  next()
})
```



**纯Js的方式引入**

```javascript
<script type="text/javascript">
var _paq = _paq || [];
/* tracker methods like "setCustomDimension" should be called before "trackPageView" */
_paq.push(['trackPageView']);
_paq.push(['enableLinkTracking']);
(function() {
var u="//bayes.test.com/piwik/";
_paq.push(['setTrackerUrl', u+'piwik.php']);
_paq.push(['setSiteId', '412']); // 注意这里的setSiteId，后面的数字就是你的网站id，在matomo网站上可以查到
var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
})();
</script>
```

```javascript
<script type="text/javascript">
  var _paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//matomo.name.xyz/";// // 这里配置你自己的piwik服务器地址和网站ID
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '5']);//setId
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
  })();
<script>
```

